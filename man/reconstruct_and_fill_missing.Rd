% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reconstruct_and_fill_missing.R
\name{reconstruct_and_fill_missing}
\alias{reconstruct_and_fill_missing}
\title{Reconstruct and Fill Missing Combinations}
\usage{
reconstruct_and_fill_missing(
  data,
  keys,
  completion_col,
  date_col,
  fill_value = NA,
  fill_cols = setdiff(names(data), keys)
)
}
\arguments{
\item{data}{A data frame of observations, including columns to be filled.}

\item{keys}{A character vector of column names that uniquely identify each
observation (e.g., \code{c("date", "depth", "species")}).
These columns define the combinations to check for completeness.}

\item{completion_col}{The name of the column within \code{keys} whose values
should be made complete (e.g., \code{"depth"}). The set of values used for
completion depends on the \code{date_col}.}

\item{date_col}{The name of the column within \code{keys} that represents the
date or primary grouping (e.g., \code{"date"}). The set of values
for \code{completion_col} is determined based on this column.}

\item{fill_value}{The value for filling missing entries in \code{fill_cols}.
Defaults to \code{0}. Can be \code{NA}.}

\item{fill_cols}{A character vector of column names in \code{data} that should
be filled with \code{fill_value} where combinations are missing. These columns
should not be in \code{keys}.}
}
\value{
A data frame with missing combinations reconstructed and specified
columns filled with \code{fill_value}, considering only completion values observed
on each specific date for entities present on that date. The output is
arranged by the \code{keys} provided in the input.
}
\description{
Reconstruct missing rows in a data frame for specific combinations of key
columns. It is primarily intended for multivariate time series data, where
for each date and for each combination of columns present on that date,
all values for a specified completion column observed on that date will be
present, and missing combinations are filled with a user-defined value.
The set of values used for the completion column is determined individually
for each date, based on the values present in the input data for that date.
}
\examples{

# --- Example Usage ---

set.seed(234)
tbl <- expand.grid(
  date = c("2025-01-10", "2025-02-12", "2025-03-17"),
  depth = 1:5,
  species = LETTERS[1:5]) |>
  mutate(value = sample(0:2, n(), replace = TRUE)) |>
  mutate(value2 = value * 10 + sample(0:9, n(), replace = TRUE)) |>
  ## Filter out some data, including original 0s in 'value' and some combinations
  filter(value != 0) |> # Remove original 0s in 'value'
  filter(!(date == "2025-02-12" & species == "B")) |> # Remove a species completely for a date
  filter(!(date == "2025-03-17" & species == "C")) |> # Remove another species completely for a date
  filter(!(date == "2025-01-10" & depth > 3)) # Remove depths > 3 for a date, and any species/value combos with them

# Data before reconstruction (shows missing rows and original values)
print("--- Original Data (filtered) ---")
print(tbl)


keys <- c("date", "depth", "species")
date_col <- "date"
completion_col <- "depth"


# --- Test Cases ---

# 1. Fill all with NA (default)
print("--- Reconstructed (default fill = 0) ---")
reconstructed_default <- reconstruct_and_fill_missing(
  tbl, keys, completion_col, date_col)
print(reconstructed_default, n = 40)

# Verify depths for 2025-01-10 (should be 1, 2, 3)
print("Depths for 2025-01-10 (default fill):")
reconstructed_default |> filter(date == "2025-01-10") |> distinct(depth) |> print()


# 2. Fill with 0
fill_cols <- "value2" # Specify which columns to fill
print("--- Reconstructed (fill = NA) ---")
reconstructed_0 <- reconstruct_and_fill_missing(
  tbl, keys, completion_col, date_col, fill_cols, fill_value = 0
)
print(reconstructed_0, n = 40)

# Verify depths for 2025-01-10 (should be 1, 2, 3)
print("Depths for 2025-01-10 (NA fill):")
reconstructed_0 |> filter(date == "2025-01-10") |> distinct(depth) |> print()

# 3. Fill with a specific value (e.g., -999)
fill_cols <- c("value", "value2") # Specify which columns to fill
print("--- Reconstructed (fill = -999) ---")
reconstructed_custom <- reconstruct_and_fill_missing(
  tbl, keys, completion_col, date_col, fill_cols, fill_value = -999
)
print(reconstructed_custom, n = 40)


}
